<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>جدول السكان - عمارة 160</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css"/>

  <!-- jQuery + DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

  <!-- Buttons extension -->
 <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Cairo', sans-serif;
      padding: 20px;
      background-color: #f4f4f9;
    }

    h2 {
      text-align: center;
      font-size: 32px;
      margin-bottom: 30px;
      color: #2c3e50;
      text-shadow: 1px 1px 2px #aaa;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      direction: rtl;
      font-size: 18px;
      font-weight: bold;
    }

    thead th, tbody td {
      text-align: center;
      padding: 12px;
    }

    .filters {
      margin-bottom: 20px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .filters select {
      padding: 12px 16px;
      min-width: 170px;
      font-size: 18px;
      font-weight: bold;
      height: 50px;
    }

    .reset-button {
      padding: 12px 20px;
      font-size: 18px;
      font-weight: bold;
      background-color: #d9534f;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }

    .dt-buttons {
      text-align: center;
      margin-bottom: 20px;
    }

    .dt-button {
      font-size: 16px !important;
      padding: 8px 16px !important;
      margin: 0 5px;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<h2>جدول السكان - عمارة 160 حي النرجس</h2>

<div class="filters">
  <select id="filter-flat"><option value="">الشقة</option></select>
  <select id="filter-name"><option value="">الاسم</option></select>
  <select id="filter-phone"><option value="">رقم التليفون</option></select>
  <select id="filter-floor"><option value="">الدور</option></select>
  <select id="filter-location"><option value="">موقع الشقة</option></select>
  <button class="reset-button" id="resetFilters">إعادة تعيين الفلاتر</button>
</div>

<table id="residentTable" class="display">
  <thead>
    <tr>
      <th>الشقة</th>
      <th>الاسم</th>
      <th>رقم التليفون</th>
      <th>الدور</th>
      <th>موقع الشقة من المدخل</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>1</td><td>أ / حسن ابو جنى</td><td>01092202965</td><td>الأرضي</td><td>أمامي يمين</td></tr>
    <tr><td>2</td><td>أ / فاطمة أم علي</td><td>01156674131</td><td>الأرضي</td><td>خلفي يمين</td></tr>
    <tr><td>3</td><td></td><td></td><td>الأرضي</td><td>خلفي يسار</td></tr>
    <tr><td>4</td><td>أ / محمد فايز</td><td>01119390521</td><td>الأرضي</td><td>أمامي يسار</td></tr>
    <tr><td>5</td><td>أ / عبد الجواد محمود</td><td>01158054831</td><td>الأول</td><td>أمامي يمين</td></tr>
    <tr><td>6</td><td>أ / محمود رجب</td><td>01116616374</td><td>الأول</td><td>خلفي يمين</td></tr>
    <tr><td>7</td><td>أ / يوسف محمد</td><td>01142378908</td><td>الأول</td><td>خلفي يسار</td></tr>
    <tr><td>8</td><td>أ / مينا</td><td>01551453696</td><td>الأول</td><td>أمامي يسار</td></tr>
    <tr><td>9</td><td>أ / محمد قرني</td><td>01144692648</td><td>الثاني</td><td>أمامي يمين</td></tr>
    <tr><td>10</td><td></td><td></td><td>الثاني</td><td>خلفي يمين</td></tr>
    <tr><td>11</td><td>أ / احمد الهواري</td><td>01007366895</td><td>الثاني</td><td>خلفي يسار</td></tr>
    <tr><td>12</td><td>أ / زيزو</td><td>01148310848</td><td>الثاني</td><td>أمامي يسار</td></tr>
    <tr><td>13</td><td>أ / ابو دارين</td><td>01126358826</td><td>الثالث</td><td>أمامي يمين</td></tr>
    <tr><td>14</td><td>أ / محمد سمير</td><td>01114955977</td><td>الثالث</td><td>خلفي يمين</td></tr>
    <tr><td>15</td><td>أ / محمد عبد المحسن</td><td>01065758723</td><td>الثالث</td><td>خلفي يسار</td></tr>
    <tr><td>16</td><td>أ / رحاب</td><td>‪01013030015‬</td><td>الثالث</td><td>أمامي يسار</td></tr>
    <tr><td>17</td><td>أ / نبيل سالم</td><td>01147499393</td><td>الرابع</td><td>أمامي يمين</td></tr>
    <tr><td>18</td><td>أ / محمد إسماعيل</td><td>01122861410</td><td>الرابع</td><td>خلفي يمين</td></tr>
    <tr><td>19</td><td></td><td></td><td>الرابع</td><td>خلفي يسار</td></tr>
    <tr><td>20</td><td>أ / احمد مجدي</td><td>01151750099</td><td>الرابع</td><td>أمامي يسار</td></tr>
    <tr><td>21</td><td>أ / ام كنزي</td><td>01144098787</td><td>الخامس</td><td>أمامي يمين</td></tr>
    <tr><td>22</td><td>أ / ام عمر</td><td>01121983188</td><td>الخامس</td><td>خلفي يمين</td></tr>
    <tr><td>23</td><td>أ / ايمن نصر</td><td>01007119297</td><td>الخامس</td><td>خلفي يسار</td></tr>
    <tr><td>24</td><td>أ / أم مالك</td><td>01102927784</td><td>الخامس</td><td>أمامي يسار</td></tr>

 </tbody>
</table>

<script>
  function normalize(text) {
    return text
      .replace(/[أإآ]/g, "ا")
      .replace(/ة/g, "ه")
      .replace(/ى/g, "ي")
      .replace(/[ًٌٍَُِّْ]/g, '')
      .replace(/\s+/g, " ").trim().toLowerCase();
  }

  $.fn.dataTable.ext.type.search.string = function (data) {
    return normalize(data);
  };

  $(document).ready(function () {
    const table = $('#residentTable').DataTable({
      pageLength: 25,
      dom: 'Bfrtip',
      buttons: [
        {
          extend: 'excelHtml5',
          text: 'تصدير Excel',
          exportOptions: {
            columns: ':visible'
          }
        },
        {
       text: 'تصدير PDF ',
          action: function () {
html2canvas(document.querySelector("#residentTable"), { scale: 4 }).then(canvas => {
  const imgData = canvas.toDataURL("image/png");
  const pdf = new pdfMake.createPdf({
    content: [{ image: imgData, width: 550 }],
    defaultStyle: { font: 'Helvetica' }
  });
  pdf.download("جدول_السكان.pdf");
});
          }
        }
      ],
      language: {
        search: "بحث:",
        lengthMenu: "عرض _MENU_ صف",
        info: "عرض _START_ إلى _END_ من _TOTAL_ صف",
        paginate: {
          first: "الأول", last: "الأخير",
          next: "التالي", previous: "السابق"
        }
      },
      columnDefs: [
        { targets: [0], type: "num" },
        { targets: "_all", className: "dt-center" }
      ]
    });

    function populateFilter(colIdx, selector) {
      let values = table.column(colIdx).data().toArray().filter(v => v.trim() !== '');
      let unique = [...new Set(values)];

      if (colIdx === 3) {
        const order = ['الأرضي', 'الأول', 'الثاني', 'الثالث', 'الرابع', 'الخامس'];
        unique.sort((a, b) => order.indexOf(a) - order.indexOf(b));
      } else if (colIdx === 0) {
        unique.sort((a, b) => parseInt(a) - parseInt(b));
      } else {
        unique.sort((a, b) => normalize(a).localeCompare(normalize(b), 'ar'));
      }

      unique.forEach(val => {
        $(selector).append(`<option value="${val}">${val}</option>`);
      });

      $(selector).on('change', function () {
        const selected = $(this).val();
        if (selected === "") {
          table.column(colIdx).search('').draw();
        } else if (colIdx === 0) {
          table.column(colIdx).search('^' + selected + '$', true, false).draw();
        } else {
          table.column(colIdx).search(normalize(selected), true, false).draw();
        }
      });
    }

    populateFilter(0, '#filter-flat');
    populateFilter(1, '#filter-name');
    populateFilter(2, '#filter-phone');
    populateFilter(3, '#filter-floor');
    populateFilter(4, '#filter-location');

    $('#resetFilters').on('click', function () {
      $('.filters select').val('');
      table.columns().search('').draw();
    });
  });
</script>

</body>
</html>
